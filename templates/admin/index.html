{# project_root/templates/admin/index.html #}
{% extends "admin/index.html" %}
{% load i18n %}

{% block extrastyle %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* === CSS Variables === */
    :root {
      --primary-color: #2563eb;
      --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --secondary-color: #64748b;
      --accent-color: #0ea5e9;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --chart-line-color: #3b82f6;
      --chart-fill-color: rgba(59, 130, 246, 0.1);
      --chart-grid-color: rgba(148, 163, 184, 0.3);
    }

    /* Dark mode */
    html[data-theme="dark"] {
      --primary-color: #3b82f6;
      --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --secondary-color: #94a3b8;
      --accent-color: #06b6d4;
      --success-color: #22c55e;
      --warning-color: #fbbf24;
      --danger-color: #f87171;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: #334155;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
      --chart-line-color: #60a5fa;
      --chart-fill-color: rgba(96, 165, 250, 0.1);
      --chart-grid-color: rgba(148, 163, 184, 0.2);
    }

    /* === Global Styles === */
    body.dashboard {
      background: var(--bg-primary) !important;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    }

    /* ·∫®n sidebar CH·ªà tr√™n Dashboard */
    body.dashboard nav#nav-sidebar {
      display: none !important;
    }

    body.dashboard #content,
    body.dashboard #content-main {
      margin-left: 0 !important;
      width: auto !important;
    }

    /* === Header Modernization === */
    #header {
      background: var(--primary-gradient) !important;
      padding: 0.75rem 2rem !important;
      box-shadow: var(--shadow-lg) !important;
      border: none !important;
    }

    #header #site-name,
    #header #site-name a {
      font-size: 1.25rem !important;
      font-weight: 700 !important;
      color: #ffffff !important;
      text-decoration: none !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
    }

    #header #site-name::before {
      content: "üöÄ";
      font-size: 1rem;
    }

    #header #user-tools {
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
    }

    #header #user-tools a {
      color: rgba(255, 255, 255, 0.9) !important;
      font-size: 0.8rem !important;
      font-weight: 500 !important;
      padding: 0.375rem 0.75rem !important;
      border-radius: 0.375rem !important;
      transition: all 0.2s ease !important;
      text-decoration: none !important;
    }

    #header #user-tools a:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #ffffff !important;
    }

    /* === Optimized Layout === */
    body.dashboard #content {
      display: grid !important;
      grid-template-columns: 1fr 300px !important;
      gap: 1.5rem !important;
      margin: 1.5rem !important;
      align-items: start !important;
    }

    /* Main content area */
    .dashboard-main {
      min-width: 0 !important;
    }

    /* Recent actions sidebar */
    body.dashboard #content-related {
      grid-column: 2 !important;
      margin: 0 !important;
    }

    /* ·∫®n ti√™u ƒë·ªÅ <h1>B·∫£ng ƒëi·ªÅu khi·ªÉn> */
    body.dashboard #content h1 {
      display: none !important;
    }

    /* === Compact Welcome Section === */
    .welcome-header {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      padding: 1rem 1.5rem !important;
      border-radius: 0.75rem !important;
      margin-bottom: 1.5rem !important;
      text-align: center !important;
      box-shadow: var(--shadow-md) !important;
    }

    .welcome-title {
      font-size: 1.5rem !important;
      font-weight: 700 !important;
      margin: 0 0 0.25rem 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 0.5rem !important;
    }

    .welcome-subtitle {
      font-size: 0.9rem !important;
      margin: 0 !important;
      opacity: 0.9 !important;
    }

    /* === Compact Stats Grid === */
    .stats-grid {
      display: grid !important;
      grid-template-columns: repeat(4, 1fr) !important;
      gap: 1rem !important;
      margin-bottom: 1.5rem !important;
    }

    .stat-card {
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      padding: 1rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      transition: all 0.2s ease !important;
      text-align: center !important;
      position: relative !important;
      overflow: hidden !important;
    }

    .stat-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: var(--shadow-lg) !important;
    }

    .stat-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary-gradient);
    }

    .stat-icon {
      width: 2.5rem !important;
      height: 2.5rem !important;
      border-radius: 0.5rem !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      margin: 0 auto 0.75rem auto !important;
      font-size: 1rem !important;
      color: #ffffff !important;
    }

    .stat-value {
      font-size: 1.5rem !important;
      font-weight: 700 !important;
      color: var(--text-primary) !important;
      margin: 0 0 0.25rem 0 !important;
    }

    .stat-label {
      color: var(--text-secondary) !important;
      font-size: 0.75rem !important;
      font-weight: 500 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      margin: 0 !important;
    }

    /* === Module Styling === */
    body.dashboard #content-main .module {
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      overflow: hidden !important;
      margin-bottom: 1.5rem !important;
    }

    body.dashboard #content-main .module table caption {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      font-size: 1rem !important;
      padding: 0.75rem 1rem !important;
      text-align: left !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      text-transform: uppercase !important;
    }

    body.dashboard #content-main .app-meals.module table caption::before {
      content: "‚öôÔ∏è";
      font-size: 1rem;
    }

    body.dashboard #content-main .app-auth.module table caption::before {
      content: "üîê";
      font-size: 1rem;
    }

    body.dashboard #content-main .module table {
      width: 100% !important;
      border-collapse: collapse !important;
      margin: 0 !important;
    }

    body.dashboard #content-main .module table tbody tr {
      transition: all 0.2s ease !important;
      border-bottom: 1px solid var(--border-color) !important;
    }

    body.dashboard #content-main .module table tbody tr:hover {
      background: var(--bg-primary) !important;
    }

    body.dashboard #content-main .module table tbody tr th {
      padding: 0.75rem 1rem !important;
      text-align: left !important;
      font-weight: 500 !important;
    }

    body.dashboard #content-main .module table tbody tr th a {
      color: var(--text-primary) !important;
      text-decoration: none !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      font-size: 0.875rem !important;
    }

    body.dashboard #content-main .module table tbody tr th a:hover {
      color: var(--primary-color) !important;
    }

    body.dashboard #content-main .module table tbody tr td {
      padding: 0.75rem 1rem !important;
      text-align: right !important;
    }

    body.dashboard #content-main .module table tbody tr td a.changelink {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      padding: 0.375rem 0.75rem !important;
      border-radius: 0.375rem !important;
      text-decoration: none !important;
      font-size: 0.75rem !important;
      font-weight: 500 !important;
      transition: all 0.2s ease !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.375rem !important;
    }

    body.dashboard #content-main .module table tbody tr td a.changelink:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    body.dashboard #content-main .module table tbody tr td a.changelink::after {
      content: "‚Üí";
      font-weight: bold;
    }

    /* T·∫Øt link tr√™n caption */
    body.dashboard #content-main .app-meals.module table caption a.section,
    body.dashboard #content-main .app-auth.module table caption a.section {
      pointer-events: none !important;
      cursor: default !important;
      text-decoration: none !important;
      color: inherit !important;
    }

    /* === Recent Actions Styling === */
    body.dashboard #content-related #recent-actions-module {
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      overflow: hidden !important;
    }

    body.dashboard #content-related #recent-actions-module h2 {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      padding: 0.75rem 1rem !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      font-size: 1rem !important;
    }

    body.dashboard #content-related #recent-actions-module h2::before {
      content: "üìã";
      font-size: 1rem;
    }

    body.dashboard #content-related #recent-actions-module ul {
      padding: 0 !important;
      margin: 0 !important;
      max-height: 400px !important;
      overflow-y: auto !important;
    }

    body.dashboard #content-related #recent-actions-module li {
      padding: 0.75rem 1rem !important;
      border-bottom: 1px solid var(--border-color) !important;
      transition: all 0.2s ease !important;
      font-size: 0.85rem !important;
    }

    body.dashboard #content-related #recent-actions-module li:hover {
      background: var(--bg-primary) !important;
    }

    body.dashboard #content-related #recent-actions-module li:last-child {
      border-bottom: none !important;
    }

    /* === Charts Container === */
    .charts-container {
      margin: 0 !important;
      width: 100% !important;
    }

    .chart-card {
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      padding: 1rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      margin-bottom: 1.5rem !important;
      position: relative !important;
      overflow: hidden !important;
    }

    .chart-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary-gradient);
    }

    .chart-title {
      font-size: 1rem !important;
      font-weight: 600 !important;
      color: var(--text-primary) !important;
      margin: 0 0 1rem 0 !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
    }

    .charts-container canvas {
      width: 100% !important;
      height: 350px !important;
      border-radius: 0.375rem !important;
    }

    /* === Responsive Design === */
    @media (max-width: 1200px) {
      body.dashboard #content {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
        margin: 1rem !important;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.75rem !important;
      }
    }

    @media (max-width: 768px) {
      body.dashboard #content {
        margin: 0.75rem !important;
      }

      .stats-grid {
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
      }

      .charts-container canvas {
        height: 280px !important;
      }

      .welcome-title {
        font-size: 1.25rem !important;
      }

      .welcome-subtitle {
        font-size: 0.8rem !important;
      }
    }

    /* === Animation === */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chart-card,
    .stat-card,
    #content-main .module {
      animation: fadeInUp 0.4s ease forwards !important;
    }

    .chart-card:nth-child(2) { animation-delay: 0.1s !important; }
    .stat-card:nth-child(2) { animation-delay: 0.05s !important; }
    .stat-card:nth-child(3) { animation-delay: 0.1s !important; }
    .stat-card:nth-child(4) { animation-delay: 0.15s !important; }
  </style>
{% endblock %}

{% block content %}
  <div class="dashboard-main">
    <!-- Compact Welcome Header -->
    <div class="welcome-header">
      <h1 class="welcome-title">
        <i class="fas fa-tachometer-alt"></i>
        B·∫£ng ƒëi·ªÅu khi·ªÉn
      </h1>
      <p class="welcome-subtitle">T·ªïng quan ho·∫°t ƒë·ªông h·ªá th·ªëng</p>
    </div>

    <!-- Compact Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: var(--success-color);">
          <i class="fas fa-utensils"></i>
        </div>
        <div class="stat-value" id="total-meals">0</div>
        <div class="stat-label">T·ªïng b·ªØa ƒÉn</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background: var(--primary-color);">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-value" id="total-students">247</div>
        <div class="stat-label">H·ªçc sinh</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background: var(--warning-color);">
          <i class="fas fa-coins"></i>
        </div>
        <div class="stat-value" id="total-revenue">0‚Ç´</div>
        <div class="stat-label">Doanh thu</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background: var(--accent-color);">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-value" id="current-month">T12</div>
        <div class="stat-label">Th√°ng hi·ªán t·∫°i</div>
      </div>
    </div>

    <!-- Gi·ªØ nguy√™n n·ªôi dung g·ªëc Django admin -->
    {{ block.super }}

    <!-- Optimized Charts -->
    <div class="charts-container">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="fas fa-chart-line"></i>
          S·ªë b·ªØa ƒÉn theo th√°ng
        </h3>
        <canvas id="chartMealsByMonth"></canvas>
      </div>
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="fas fa-chart-bar"></i>
          H·ªçc ph√≠ theo th√°ng
        </h3>
        <canvas id="chartPaidByMonth"></canvas>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // ƒê·ªïi text captions
      const mealsCap = document.querySelector(
        '#content-main .app-meals.module table caption a.section'
      );
      if (mealsCap) {
        mealsCap.textContent = 'CH·ª®C NƒÇNG';
        mealsCap.setAttribute('title', 'C√°c ch·ª©c nƒÉng');
      }

      const authCap = document.querySelector(
        '#content-main .app-auth.module table caption a.section'
      );
      if (authCap) {
        authCap.textContent = 'X√ÅC TH·ª∞C V√Ä ·ª¶Y QUY·ªÄN';
        authCap.setAttribute('title', 'X√°c th·ª±c v√† ·ªßy quy·ªÅn');
      }

      // Ch√®n 2 link m·ªõi v√†o menu "Ch·ª©c nƒÉng" 
      const tbody = document.querySelector(
        '#content-main .app-meals.module table tbody'
      );
      if (tbody) {
        // Function to create new row
        function makeRow(url, text, iconClass, cssClass) {
          const tr = document.createElement('tr');
          tr.className = cssClass;
          tr.innerHTML = `
            <th scope="row">
              <a href="${url}">
                <i class="${iconClass}"></i>
                ${text}
              </a>
            </th>
            <td></td>
            <td>
              <a href="${url}" class="changelink">{% trans "ƒêi ƒë·∫øn" %}</a>
            </td>
          `;
          return tr;
        }

        const statsURL = "{% url 'meals:statistics' %}";
        const debtURL  = "{% url 'meals:student_payment_edit' %}";
        const statsText= "{% trans 'Th·ªëng k√™' %}";
        const debtText = "{% trans 'Ch·ªânh s·ª≠a c√¥ng n·ª£' %}";

        // Ch√®n "Ch·ªânh s·ª≠a c√¥ng n·ª£" v√† "Th·ªëng k√™" l√™n ƒë·∫ßu danh s√°ch
        tbody.insertBefore(makeRow(debtURL, debtText, 'fas fa-edit', 'row2'), tbody.firstChild);
        tbody.insertBefore(makeRow(statsURL, statsText, 'fas fa-chart-pie', 'row1'), tbody.firstChild);

        // Th√™m icons v√†o c√°c menu items c√≥ s·∫µn
        const links = tbody.querySelectorAll('th a');
        links.forEach(link => {
          const text = link.textContent.trim();
          const iconSpan = link.querySelector('i');
          
          if (!iconSpan) { // Ch·ªâ th√™m icon n·∫øu ch∆∞a c√≥
            let iconClass = '';
            if (text.includes('Students') || text.includes('H·ªçc sinh')) {
              iconClass = 'fas fa-users';
            } else if (text.includes('Meal records') || text.includes('B·ªØa ƒÉn') || text.includes('meal')) {
              iconClass = 'fas fa-utensils';
            } else if (text.includes('Meal balance audits') || text.includes('audit')) {
              iconClass = 'fas fa-file-alt';
            } else if (text.includes('Student health infos') || text.includes('health')) {
              iconClass = 'fas fa-heart';
            } else if (text.includes('Study groups') || text.includes('Study classes')) {
              iconClass = 'fas fa-users-cog';
            }
            
            if (iconClass) {
              const icon = document.createElement('i');
              icon.className = iconClass;
              link.insertBefore(icon, link.firstChild);
            }
          }
        });
      }

      // Th√™m icons v√†o auth module
      const authTbody = document.querySelector(
        '#content-main .app-auth.module table tbody'
      );
      if (authTbody) {
        const authLinks = authTbody.querySelectorAll('th a');
        authLinks.forEach(link => {
          const text = link.textContent.trim();
          const iconSpan = link.querySelector('i');
          
          if (!iconSpan) {
            let iconClass = '';
            if (text.includes('Groups') || text.includes('Nh√≥m')) {
              iconClass = 'fas fa-users-cog';
            } else if (text.includes('Users') || text.includes('Ng∆∞·ªùi d√πng')) {
              iconClass = 'fas fa-user';
            }
            
            if (iconClass) {
              const icon = document.createElement('i');
              icon.className = iconClass;
              link.insertBefore(icon, link.firstChild);
            }
          }
        });
      }

      // H√†m l·∫•y CSS variables
      function getV(name){
        return getComputedStyle(document.documentElement)
               .getPropertyValue(name).trim();
      }

      const months      = {{ chart_meal_labels|safe }};
      const mealCounts  = {{ chart_meal_data|safe }};
      const paidAmounts = {{ chart_paid_month_data|safe }};

      // Update stats
      const totalMeals = mealCounts.reduce((a, b) => a + b, 0);
      const totalRevenue = paidAmounts.reduce((a, b) => a + b, 0);
      
      document.getElementById('total-meals').textContent = totalMeals.toLocaleString();
      document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString() + '‚Ç´';

      // L·∫•y m√†u t·ª´ bi·∫øn
      const lineColor = getV('--chart-line-color'),
            fillColor = getV('--chart-fill-color'),
            gridColor = getV('--chart-grid-color');

      // V·∫Ω chart S·ªë b·ªØa ƒÉn
      const chartMeals = new Chart(
        document.getElementById('chartMealsByMonth').getContext('2d'),
        {
          type: 'line',
          data: {
            labels: months,
            datasets: [{
              label: 'S·ªë b·ªØa ƒÉn (' + new Date().getFullYear() + ')',
              data: mealCounts,
              fill: true,
              borderColor: lineColor,
              backgroundColor: fillColor,
              pointBackgroundColor: lineColor,
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6,
              tension: 0.4,
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  font: { size: 11, weight: '600' },
                  color: getV('--text-primary')
                }
              }
            },
            scales: {
              x: {
                grid: { color: gridColor, borderDash: [3, 3] },
                ticks: { 
                  color: getV('--text-secondary'),
                  font: { size: 10 }
                }
              },
              y: {
                beginAtZero: true,
                grid: { color: gridColor, borderDash: [3, 3] },
                ticks: { 
                  callback: v => v.toLocaleString(),
                  color: getV('--text-secondary'),
                  font: { size: 10 }
                }
              }
            }
          }
        }
      );

      // V·∫Ω chart H·ªçc ph√≠
      const ctx = document.getElementById('chartPaidByMonth').getContext('2d');
      const gradient = ctx.createLinearGradient(0, 0, 0, 350);
      gradient.addColorStop(0, lineColor);
      gradient.addColorStop(1, fillColor);

      const chartPaid = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [{
            label: 'H·ªçc ph√≠ (' + new Date().getFullYear() + ')',
            data: paidAmounts,
            backgroundColor: gradient,
            borderColor: lineColor,
            borderWidth: 2,
            borderRadius: 4,
            borderSkipped: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                font: { size: 11, weight: '600' },
                color: getV('--text-primary')
              }
            }
          },
          scales: {
            x: {
              grid: { color: gridColor, borderDash: [3, 3] },
              ticks: { 
                color: getV('--text-secondary'),
                font: { size: 10 }
              }
            },
            y: {
              beginAtZero: true,
              grid: { color: gridColor, borderDash: [3, 3] },
              ticks: { 
                callback: v => v.toLocaleString() + '‚Ç´',
                color: getV('--text-secondary'),
                font: { size: 10 }
              }
            }
          }
        }
      });

      // Observer ƒë·ªÉ update m√†u khi theme change
      new MutationObserver(muts => {
        muts.forEach(m => {
          if (m.attributeName === 'data-theme') {
            const nl = getV('--chart-line-color'),
                  nf = getV('--chart-fill-color'),
                  ng = getV('--chart-grid-color');
            
            // Update line chart
            chartMeals.data.datasets.forEach(ds => {
              ds.borderColor = nl;
              ds.pointBackgroundColor = nl;
              ds.backgroundColor = nf;
            });
            chartMeals.options.scales.x.grid.color = ng;
            chartMeals.options.scales.y.grid.color = ng;
            chartMeals.update();
            
            // Update bar chart
            const newGradient = ctx.createLinearGradient(0, 0, 0, 350);
            newGradient.addColorStop(0, nl);
            newGradient.addColorStop(1, nf);
            
            chartPaid.data.datasets.forEach(ds => {
              ds.borderColor = nl;
              ds.backgroundColor = newGradient;
            });
            chartPaid.options.scales.x.grid.color = ng;
            chartPaid.options.scales.y.grid.color = ng;
            chartPaid.update();
          }
        });
      }).observe(document.documentElement, { attributes: true });
    });
  </script>
{% endblock %}

{% block sidebar %}
  {{ block.super }}
{% endblock %}
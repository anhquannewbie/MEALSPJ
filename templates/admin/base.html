{% extends "admin/base.html" %}
{% load static i18n admin_urls %}

{% block extrahead %}
  {{ block.super }}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* === CSS Variables === */
    :root {
      --primary-color: #2563eb;
      --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --secondary-color: #64748b;
      --accent-color: #0ea5e9;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
      --filter-bg: linear-gradient(145deg, #f1f5f9 0%, #e2e8f0 100%);
      --filter-accent: #4f46e5;
    }

    /* Dark mode */
    html[data-theme="dark"] {
      --primary-color: #3b82f6;
      --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --secondary-color: #94a3b8;
      --accent-color: #06b6d4;
      --success-color: #22c55e;
      --warning-color: #fbbf24;
      --danger-color: #f87171;
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --border-color: #374151;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.5);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.5), 0 2px 4px -2px rgb(0 0 0 / 0.5);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.5);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5), 0 10px 10px -5px rgb(0 0 0 / 0.2);
      --filter-bg: linear-gradient(145deg, #1f2937 0%, #111827 100%);
      --filter-accent: #6366f1;
    }

    /* === Global Styles === */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      background: var(--bg-primary) !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    /* === Header Modernization === */
    #header {
      background: var(--primary-gradient) !important;
      padding: 0.75rem 2rem !important;
      box-shadow: var(--shadow-lg) !important;
      border: none !important;
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      z-index: 1000 !important;
      height: 60px !important;
      box-sizing: border-box !important;
    }

    #header #site-name,
    #header #site-name a {
      font-size: 1.25rem !important;
      font-weight: 700 !important;
      color: #ffffff !important;
      text-decoration: none !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    #header #site-name::before {
      content: "üöÄ";
      font-size: 1rem;
    }

    #header #user-tools {
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
    }

    #header #user-tools a {
      color: rgba(255, 255, 255, 0.9) !important;
      font-size: 0.8rem !important;
      font-weight: 500 !important;
      padding: 0.375rem 0.75rem !important;
      border-radius: 0.375rem !important;
      transition: all 0.2s ease !important;
      text-decoration: none !important;
    }

    #header #user-tools a:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #ffffff !important;
    }

    /* === Body Padding for Fixed Header === */
    body {
      padding-top: 60px !important;
    }

    /* === Sidebar Control === */
    /* CH·ªà ·∫®N sidebar tr√™n Dashboard */
    body.dashboard #nav-sidebar { 
      display: none !important; 
    }
    body.dashboard #content,
    body.dashboard #content-main {
      margin-left: 0 !important;
      width: auto !important;
    }

    /* Tr√™n m·ªçi page kh√°c, b·∫Øt bu·ªôc hi·ªÉn th·ªã sidebar */
    body:not(.dashboard) #nav-sidebar { 
      display: block !important;
      width: 390px !important;
      background: var(--bg-secondary) !important;
      border-right: 1px solid var(--border-color) !important;
      box-shadow: var(--shadow-lg) !important;
      position: fixed !important;
      top: 60px !important;
      left: 0 !important;
      bottom: 0 !important;
      overflow-y: auto !important;
      z-index: 999 !important;
      padding: 1rem 0 !important;
    }

    /* Adjust content margin for sidebar pages */
    body:not(.dashboard) #content {
      margin-left: 390px !important;
      background: var(--bg-primary) !important;
      min-height: calc(100vh - 60px) !important;
      padding: 1.5rem !important;
      box-sizing: border-box !important;
    }

    /* T·∫°o kho·∫£ng tr·ªëng b√™n ph·∫£i cho filter khi c√≥ filter */
    body:not(.dashboard).filtered #content {
      padding-right: 320px !important; /* 280px + 40px gap */
    }

    /* Modern sidebar modules */
    body:not(.dashboard) #nav-sidebar .module {
      margin: 0 1rem 1rem 1rem !important;
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      overflow: hidden !important;
    }
    .inline-group .tabular td.original p {
      position: absolute;
      left: 0;
      height: 1.1em;
      padding: 2px 9px;
      overflow: hidden;
      font-size: 0.5625rem;
      font-weight: bold;
      color: var(--body-quiet-color);
      _width: 700px;
      margin-left: 20px;
    }
    /* Sidebar module headers - FORCE background ƒë·∫ßy ƒë·ªß */
    body:not(.dashboard) #nav-sidebar .module table caption {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      font-size: 0.9rem !important;
      padding: 0.75rem 1rem !important;
      text-align: left !important;
      margin: 0 !important;
      width: 100% !important;
      box-sizing: border-box !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      border-radius: 0.75rem 0.75rem 0 0 !important;
      border: none !important;
      background-clip: border-box !important;
      background-size: cover !important;
      background-repeat: no-repeat !important;
      background-attachment: local !important;
      position: relative !important;
      min-height: 45px !important;
      overflow: hidden !important;
    }

    /* Force background to extend fully */
    body:not(.dashboard) #nav-sidebar .module table caption::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--primary-gradient);
      z-index: -1;
    }

    body:not(.dashboard) #nav-sidebar .module table caption a.section {
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      color: inherit !important;
      text-decoration: none !important;
      width: 100% !important;
      height: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
      background: transparent !important;
      position: relative !important;
      z-index: 1 !important;
      min-height: 45px !important;
      box-sizing: border-box !important;
    }

    /* === ·∫®N HO√ÄN TO√ÄN C√îNG N·ª¢ H·ªåC SINH === */
    /* CSS selector ƒë·ªÉ ·∫©n row studentpayment */
    body:not(.dashboard) #nav-sidebar .module table tbody tr.model-studentpayment {
      display: none !important;
    }
    
    /* Backup selectors */
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th a[href*="studentpayment"]),
    body:not(.dashboard) #nav-sidebar .module table tbody tr th a[href*="studentpayment"],
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th a:contains("C√¥ng n·ª£ h·ªçc sinh")),
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th:contains("C√¥ng n·ª£ h·ªçc sinh")) {
      display: none !important;
    }

    /* Add icons to sidebar headers */
    body:not(.dashboard) #nav-sidebar .app-meals.module table caption::before {
      content: "‚öôÔ∏è";
      font-size: 0.9rem;
    }

    body:not(.dashboard) #nav-sidebar .app-auth.module table caption::before {
      content: "üîê";
      font-size: 0.9rem;
    }

    /* Sidebar tables */
    body:not(.dashboard) #nav-sidebar .module table {
      width: 100% !important;
      border-collapse: collapse !important;
      margin: 0 !important;
      table-layout: fixed !important;
    }

    body:not(.dashboard) #nav-sidebar .module table caption {
      width: 100% !important;
      box-sizing: border-box !important;
      table-layout: fixed !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr {
      transition: all 0.2s ease !important;
      border-bottom: 1px solid var(--border-color) !important;
      width: 100% !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr:hover {
      background: var(--bg-primary) !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr:last-child {
      border-bottom: none !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr th {
      width: 70% !important;
      padding: 0.75rem 1rem !important;
      text-align: left !important;
      font-weight: 500 !important;
      box-sizing: border-box !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr td {
      width: 30% !important;
      padding: 0.75rem 1rem !important;
      text-align: center !important;
      box-sizing: border-box !important;
    }

    /* Sidebar links */
    body:not(.dashboard) #nav-sidebar .module table tbody tr th a {
      color: var(--text-primary) !important;
      text-decoration: none !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      font-size: 0.85rem !important;
      transition: all 0.2s ease !important;
      line-height: 1.3 !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      width: 100% !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr th a i {
      flex-shrink: 0 !important;
      width: 16px !important;
      text-align: center !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr th a:hover {
      color: var(--primary-color) !important;
      transform: translateX(2px) !important;
    }

    /* Sidebar action links */
    body:not(.dashboard) #nav-sidebar .module table tbody tr td a.changelink {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      padding: 0.25rem 0.5rem !important;
      border-radius: 0.25rem !important;
      text-decoration: none !important;
      font-size: 0.7rem !important;
      font-weight: 500 !important;
      transition: all 0.2s ease !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.25rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      white-space: nowrap !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr td a.changelink:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-sm) !important;
    }

    body:not(.dashboard) #nav-sidebar .module table tbody tr td a.changelink::after {
      content: "‚Üí";
      font-weight: bold;
      font-size: 0.7rem;
    }

    /* Disable caption links */
    body:not(.dashboard) #nav-sidebar .app-meals.module table caption a.section,
    body:not(.dashboard) #nav-sidebar .app-auth.module table caption a.section {
      pointer-events: none !important;
      cursor: default !important;
      text-decoration: none !important;
      color: inherit !important;
    }

    /* === ·∫®N C√îNG N·ª¢ H·ªåC SINH === */
    /* ·∫®n row c√≥ text "C√¥ng n·ª£ h·ªçc sinh" */
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th a[href*="student_debt"]),
    body:not(.dashboard) #nav-sidebar .module table tbody tr th a[href*="student_debt"],
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th a:contains("C√¥ng n·ª£ h·ªçc sinh")),
    body:not(.dashboard) #nav-sidebar .module table tbody tr:has(th:contains("C√¥ng n·ª£ h·ªçc sinh")) {
      display: none !important;
    }

    /* === B·ªé ADDLINK TH√äM V√ÄO B·ªÆA ƒÇN TRONG CONTENT AREA === */
    /* CH·ªà ·∫®N addlink trong content area, KH√îNG ·∫©n trong sidebar */
    body:not(.dashboard) #content .object-tools .addlink,
    body:not(.dashboard) #content .object-tools a[href*="/add/"],
    body:not(.dashboard) #content .addlink,
    body:not(.dashboard) #content-main .object-tools .addlink,
    body:not(.dashboard) #content-main .object-tools a[href*="/add/"],
    body:not(.dashboard) #content-main .addlink {
      display: none !important;
    }

    /* GI·ªÆ L·∫†I addlink trong sidebar */
    body:not(.dashboard) #nav-sidebar .addlink,
    body:not(.dashboard) #nav-sidebar .object-tools .addlink {
      display: inline-flex !important;
    }

    /* === FIX MISSING ACTION BUTTONS === */
    /* Allow custom classroom action buttons to be visible */
    body:not(.dashboard) #content .object-tools a[href*="/delete_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/export_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/import_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/promote_students/"],
    body:not(.dashboard) #content a[href*="/delete_students/"],
    body:not(.dashboard) #content a[href*="/export_students/"],
    body:not(.dashboard) #content a[href*="/import_students/"],
    body:not(.dashboard) #content a[href*="/promote_students/"] {
      display: inline-flex !important;
    }

    /* === HIDE DUPLICATE MARKERS === */
    /* Hide the original template-generated buttons to avoid duplicates */
    /* Target the standalone <li> elements that are outside <ul> */
    body:not(.dashboard) #content li:has(a[href*="/delete_students/"]),
    body:not(.dashboard) #content li:has(a[href*="/export_students/"]),
    body:not(.dashboard) #content li:has(a[href*="/import_students/"]),
    body:not(.dashboard) #content li:has(a[href*="/promote_students/"]) {
      display: none !important;
    }

    /* Also hide by direct element targeting */
    body:not(.dashboard) #content li a.deletelink[href*="/delete_students/"],
    body:not(.dashboard) #content li a.addlink[href*="/export_students/"],
    body:not(.dashboard) #content li a.addlink[href*="/import_students/"],
    body:not(.dashboard) #content li a.addlink[href*="/promote_students/"] {
      display: none !important;
    }

    /* Hide parent <li> elements by targeting specific hrefs */
    body:not(.dashboard) #content li:has(a[href="/admin/meals/classroom/27/delete_students/"]),
    body:not(.dashboard) #content li:has(a[href="/admin/meals/classroom/27/export_students/"]),
    body:not(.dashboard) #content li:has(a[href="/admin/meals/classroom/27/import_students/"]),
    body:not(.dashboard) #content li:has(a[href="/admin/meals/classroom/27/promote_students/"]) {
      display: none !important;
    }

    /* Fallback - hide any standalone li after object-tools */
    body:not(.dashboard) #content .object-tools ~ li {
      display: none !important;
    }

    /* === CUSTOM ACTION BUTTONS STYLING === */
    /* Transform addlinks to proper buttons */
    body:not(.dashboard) #content .object-tools a[href*="/delete_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/export_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/import_students/"],
    body:not(.dashboard) #content .object-tools a[href*="/promote_students/"] {
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      padding: 0.75rem 1.25rem !important;
      border-radius: 0.5rem !important;
      text-decoration: none !important;
      font-weight: 600 !important;
      font-size: 0.9rem !important;
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      border: none !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    /* Specific button colors */
    body:not(.dashboard) #content .object-tools a[href*="/delete_students/"] {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
      color: #ffffff !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/delete_students/"]:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/export_students/"] {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
      color: #ffffff !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/export_students/"]:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/import_students/"] {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
      color: #ffffff !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/import_students/"]:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/promote_students/"] {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
      color: #ffffff !important;
    }

    body:not(.dashboard) #content .object-tools a[href*="/promote_students/"]:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
    }

    /* History button styling to match */
    body:not(.dashboard) #content .object-tools a.historylink {
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      padding: 0.75rem 1.25rem !important;
      border-radius: 0.5rem !important;
      text-decoration: none !important;
      font-weight: 600 !important;
      font-size: 0.9rem !important;
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      border: none !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%) !important;
      color: #ffffff !important;
      margin-right: 20px;
    }

    body:not(.dashboard) #content .object-tools a.historylink:hover {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3) !important;
    }

    /* === OBJECT-TOOLS LAYOUT === */
    /* Restructure object-tools to vertical layout */
    body:not(.dashboard) #content .object-tools {
      background: transparent !important;
      padding: 0 !important;
      border: none !important;
      margin: 0 !important;
      margin-bottom: 1.5rem !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 1rem !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      position: relative !important;
      z-index: 1 !important;
      
    }

    /* First row: History button */
    body:not(.dashboard) #content .object-tools ul {
      list-style: none !important;
      padding: 0 !important;
      margin: 0 !important;
      display: flex !important;
      gap: 0.75rem !important;
      flex-wrap: wrap !important;
      order: 1 !important;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }

    body:not(.dashboard) #content .object-tools li {
      margin: 0 !important;
      padding: 0 !important;
      background: transparent !important;
    }

    /* Second row: Custom action buttons */
    body:not(.dashboard) #content .object-tools::after {
      content: "";
      display: flex !important;
      gap: 0.75rem !important;
      flex-wrap: wrap !important;
      order: 2 !important;
    }

    /* Force clear any floating or positioning issues */
    body:not(.dashboard) #content .object-tools + * {
      clear: both !important;
      margin-top: 0 !important;
    }

    /* === MAIN LAYOUT CONTAINER === */
    /* T·∫°o container t·ªïng cho to√†n b·ªô content */
    body:not(.dashboard) #content-main {
      display: flex !important;
      /* gap: 1.5rem !important; */
      align-items: flex-start !important;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
      overflow: visible !important;
    }

    /* === MAIN CONTENT AREA === */
    /* Content ch√≠nh (b·∫£ng, form, etc.) chi·∫øm ph·∫ßn l·ªõn kh√¥ng gian */
    body:not(.dashboard) #changelist,
    body:not(.dashboard) .module:not(#changelist-filter) {
      flex: 1 !important;
      min-width: 0 !important;
      background: var(--bg-secondary) !important;
      border-radius: 0.75rem !important;
      box-shadow: var(--shadow-md) !important;
      border: 1px solid var(--border-color) !important;
      overflow: hidden !important;
      margin: 0 !important;
      position: relative !important;
      z-index: 1 !important;
    }

    /* Reset changelist layout v·ªÅ d·∫°ng block th√¥ng th∆∞·ªùng */
    body:not(.dashboard) #changelist {
      display: block !important;
      clear: both !important;
    }

    body:not(.dashboard) #changelist .results {
      width: 100% !important;
      margin: 0 !important;
      position: relative !important;
    }

    /* Ensure proper spacing after object-tools */
    body:not(.dashboard) #changelist-search,
    body:not(.dashboard) #toolbar,
    body:not(.dashboard) .actions,
    body:not(.dashboard) .results {
      margin-top: 0 !important;
      clear: both !important;
    }

    /* === ENHANCED FILTER SIDEBAR === */
    /* ƒê∆∞a filter v·ªÅ ph√≠a b√™n ph·∫£i v·ªõi thi·∫øt k·∫ø hi·ªán ƒë·∫°i */
    body:not(.dashboard) #changelist-filter {
      position: fixed !important;
      top: 80px !important;
      right: 20px !important;
      bottom: 20px !important;
      width: 320px !important;
      min-width: 320px !important;
      max-width: 320px !important;
      background: var(--filter-bg) !important;
      border: 2px solid var(--filter-accent) !important;
      border-radius: 1rem !important;
      box-shadow: var(--shadow-xl) !important;
      padding: 0 !important;
      margin: 0 !important;
      overflow: hidden !important;
      z-index: 998 !important;
      flex-shrink: 0 !important;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
      animation: filterSlideIn 0.5s ease !important;
      backdrop-filter: blur(10px) !important;
      -webkit-backdrop-filter: blur(10px) !important;
    }

    body:not(.dashboard) #changelist-filter.hidden {
      transform: translateX(100%) !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }

    /* === ENHANCED FILTER CONTENT === */
    body:not(.dashboard) #changelist-filter h2 {
      background: linear-gradient(135deg, var(--filter-accent) 0%, #7c3aed 100%) !important;
      color: #ffffff !important;
      padding: 1.25rem !important;
      margin: 0 !important;
      font-size: 1rem !important;
      font-weight: 700 !important;
      border-radius: 1rem 1rem 0 0 !important;
      text-align: center !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 0.75rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.1em !important;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3) !important;
    }

    body:not(.dashboard) #changelist-filter h2::before {
      content: "üéØ";
      font-size: 1.2rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* Filter scrollable content */
    body:not(.dashboard) #changelist-filter > div {
      overflow-y: auto !important;
      scrollbar-width: thin !important;
      scrollbar-color: var(--filter-accent) transparent !important;
      padding: 0 !important; /* Lo·∫°i b·ªè padding m·∫∑c ƒë·ªãnh */
      margin: 0 !important; /* Lo·∫°i b·ªè margin m·∫∑c ƒë·ªãnh */
    }

    body:not(.dashboard) #changelist-filter > div::-webkit-scrollbar {
      width: 6px !important;
    }

    body:not(.dashboard) #changelist-filter > div::-webkit-scrollbar-track {
      background: transparent !important;
    }

    body:not(.dashboard) #changelist-filter > div::-webkit-scrollbar-thumb {
      background: var(--filter-accent) !important;
      border-radius: 3px !important;
    }

    /* Lo·∫°i b·ªè kho·∫£ng tr·ªëng trong filter form rows */
    body:not(.dashboard) #changelist-filter .form-row {
      margin: 0 !important;
      padding: 1rem 1.25rem !important;
      border-bottom: 1px solid rgba(79, 70, 229, 0.1) !important;
      background: var(--bg-secondary) !important;
    }

    body:not(.dashboard) #changelist-filter .form-row:first-child {
      margin-top: 0 !important;
      padding-top: 1rem !important;
    }

    body:not(.dashboard) #changelist-filter .form-row:last-child {
      border-bottom: none !important;
      margin-bottom: 0 !important;
      padding-bottom: 1rem !important;
    }

    body:not(.dashboard) #changelist-filter .form-row label {
      margin: 0 !important;
      padding: 0 !important;
      display: block !important;
      font-weight: 600 !important;
      color: var(--filter-accent) !important;
      text-transform: uppercase !important;
      font-size: 0.85rem !important;
      letter-spacing: 0.05em !important;
      margin-bottom: 0.5rem !important;
    }

    body:not(.dashboard) #changelist-filter .form-row select,
    body:not(.dashboard) #changelist-filter .form-row input {
      margin: 0 !important;
      width: 100% !important;
      padding: 0.75rem !important;
      border: 2px solid var(--filter-accent) !important;
      border-radius: 0.5rem !important;
      background: var(--bg-primary) !important;
      color: var(--text-primary) !important;
      font-size: 0.9rem !important;
      box-sizing: border-box !important;
    }

    body:not(.dashboard) #changelist-filter h3 {
      background: linear-gradient(90deg, rgba(79, 70, 229, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%) !important;
      color: var(--filter-accent) !important;
      padding: 1rem 1.25rem !important;
      margin: 0 !important;
      font-size: 0.95rem !important;
      font-weight: 700 !important;
      border-bottom: 2px solid rgba(79, 70, 229, 0.2) !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.75rem !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      position: sticky !important;
      top: 0 !important;
      z-index: 10 !important;
      backdrop-filter: blur(5px) !important;
    }

    /* Enhanced filter section icons */
    body:not(.dashboard) #changelist-filter h3::before {
      content: "üìä";
      font-size: 1rem;
      background: linear-gradient(135deg, var(--filter-accent), #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    body:not(.dashboard) #changelist-filter ul {
      margin: 0 !important;
      padding: 0 !important;
      list-style: none !important;
      background: var(--bg-secondary) !important;
    }

    body:not(.dashboard) #changelist-filter li {
      padding: 0 !important;
      border-bottom: 1px solid rgba(79, 70, 229, 0.1) !important;
      transition: all 0.3s ease !important;
      position: relative !important;
      overflow: hidden !important;
    }

    body:not(.dashboard) #changelist-filter li:last-child {
      border-bottom: none !important;
    }

    body:not(.dashboard) #changelist-filter li:hover {
      background: linear-gradient(90deg, rgba(79, 70, 229, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%) !important;
      transform: translateX(2px) !important;
    }

    body:not(.dashboard) #changelist-filter li::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(135deg, var(--filter-accent), #7c3aed);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    body:not(.dashboard) #changelist-filter li:hover::before {
      transform: scaleY(1);
    }

    body:not(.dashboard) #changelist-filter a {
      display: block !important;
      padding: 1rem 1.25rem !important;
      color: var(--text-primary) !important;
      text-decoration: none !important;
      font-size: 0.9rem !important;
      font-weight: 500 !important;
      transition: all 0.3s ease !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      line-height: 1.5 !important;
      position: relative !important;
    }

    body:not(.dashboard) #changelist-filter a::after {
      content: "";
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--filter-accent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    body:not(.dashboard) #changelist-filter a:hover {
      color: var(--filter-accent) !important;
      background: transparent !important;
      transform: translateX(8px) !important;
      font-weight: 600 !important;
    }

    body:not(.dashboard) #changelist-filter a:hover::after {
      opacity: 1;
    }

    body:not(.dashboard) #changelist-filter .selected {
      background: linear-gradient(90deg, rgba(79, 70, 229, 0.15) 0%, rgba(124, 58, 237, 0.15) 100%) !important;
      border-left: 4px solid var(--filter-accent) !important;
    }

    body:not(.dashboard) #changelist-filter .selected a {
      background: transparent !important;
      color: var(--filter-accent) !important;
      font-weight: 700 !important;
      position: relative !important;
    }

    body:not(.dashboard) #changelist-filter .selected a::before {
      content: "‚óè";
      position: absolute;
      right: 1.25rem;
      font-weight: bold;
      font-size: 1rem;
      color: var(--filter-accent);
      animation: selectedPulse 2s infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }

    /* Enhanced toggle button */
    body:not(.dashboard) .filter-toggle {
      position: fixed !important;
      top: 120px !important;
      right: 20px !important;
      width: 50px !important;
      height: 50px !important;
      background: linear-gradient(135deg, var(--filter-accent) 0%, #7c3aed 100%) !important;
      color: #ffffff !important;
      border: none !important;
      border-radius: 50% !important;
      font-size: 1.4rem !important;
      cursor: pointer !important;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4) !important;
      z-index: 999 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      backdrop-filter: blur(10px) !important;
    }

    body:not(.dashboard) .filter-toggle:hover {
      transform: scale(1.15) rotate(5deg) !important;
      box-shadow: 0 12px 35px rgba(79, 70, 229, 0.6) !important;
    }

    body:not(.dashboard) .filter-toggle:active {
      transform: scale(0.95) !important;
    }

    /* Main content headers */
    body:not(.dashboard) #content h1,
    body:not(.dashboard) #content-main h1 {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      font-size: 1.25rem !important;
      margin: 0 !important;
      padding: 1rem 1.5rem !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      border-radius: 0.75rem 0.75rem 0 0 !important;
    }

    body:not(.dashboard) #content h1::before,
    body:not(.dashboard) #content-main h1::before {
      content: "üìÑ";
      font-size: 1rem;
    }

    /* Content Body */
    body:not(.dashboard) #content-main .module h2,
    body:not(.dashboard) #content-main .module h3 {
      background: var(--bg-primary) !important;
      color: var(--text-primary) !important;
      font-weight: 600 !important;
      padding: 0.75rem 1.5rem !important;
      margin: 0 !important;
      border-bottom: 1px solid var(--border-color) !important;
      font-size: 1rem !important;
    }

    /* Form styling for sidebar pages */
    body:not(.dashboard) .form-row {
      margin: 0 1.5rem 1.5rem 1.5rem !important;
      padding-top: 1rem !important;
    }

    body:not(.dashboard) .form-row:first-child {
      padding-top: 1.5rem !important;
    }

    body:not(.dashboard) .form-row label {
      color: var(--text-primary) !important;
      font-weight: 600 !important;
      margin-bottom: 0.5rem !important;
      display: block !important;
      font-size: 0.9rem !important;
    }

    body:not(.dashboard) input[type="text"],
    body:not(.dashboard) input[type="email"],
    body:not(.dashboard) input[type="password"],
    body:not(.dashboard) input[type="number"],
    body:not(.dashboard) input[type="date"],
    body:not(.dashboard) input[type="datetime-local"],
    body:not(.dashboard) select,
    body:not(.dashboard) textarea {
      width: 96% !important;
      max-width: 100% !important;
      border: 1px solid var(--border-color) !important;
      border-radius: 0.5rem !important;
      background: var(--bg-primary) !important;
      color: var(--text-primary) !important;
      font-size: 0.9rem !important;
      transition: all 0.2s ease !important;
      box-sizing: border-box !important;
    }

    body:not(.dashboard) input:focus,
    body:not(.dashboard) select:focus,
    body:not(.dashboard) textarea:focus {
      outline: none !important;
      border-color: var(--primary-color) !important;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
    }

    /* Multi-column form layout fix */
    body:not(.dashboard) .form-row::after {
      content: "";
      display: table;
      clear: both;
    }

    body:not(.dashboard) .form-row > div {
      float: none !important;
      width: 100% !important;
      margin-right: 0 !important;
    }

    /* Inline form elements */
    body:not(.dashboard) .form-row.field-name .form-row,
    body:not(.dashboard) .form-row.field-first_name,
    body:not(.dashboard) .form-row.field-last_name {
      display: inline-block !important;
      width: 48% !important;
      margin-right: 2% !important;
      vertical-align: top !important;
    }

    body:not(.dashboard) .form-row.field-last_name {
      margin-right: 0 !important;
    }

    /* Button styling */
    body:not(.dashboard) .submit-row {
      background: var(--bg-primary) !important;
      padding: 1rem 1.5rem !important;
      border-top: 1px solid var(--border-color) !important;
      margin: 0 !important;
      text-align: right !important;
    }

    body:not(.dashboard) .submit-row input[type="submit"],
    body:not(.dashboard) .button,
    body:not(.dashboard) input[type="submit"] {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      padding: 0.75rem 1.5rem !important;
      border: none !important;
      border-radius: 0.5rem !important;
      font-size: 0.9rem !important;
      font-weight: 600 !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      text-decoration: none !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
    }

    body:not(.dashboard) .submit-row input[type="submit"]:hover,
    body:not(.dashboard) .button:hover,
    body:not(.dashboard) input[type="submit"]:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    /* Table styling for sidebar pages */
    body:not(.dashboard) .results {
      margin: 0 !important;
      border-radius: 0 !important;
      background: var(--bg-secondary) !important;
    }

    body:not(.dashboard) .results table,
    body:not(.dashboard) #changelist-search table {
      width: 100% !important;
      border-collapse: collapse !important;
      background: var(--bg-secondary) !important;
      margin: 0 !important;
      color: var(--text-primary) !important;
    }

    body:not(.dashboard) .results thead th {
      background: var(--bg-primary) !important;
      color: var(--text-primary) !important;
      font-weight: 600 !important;
      padding: 1rem !important;
      text-align: left !important;
      border-bottom: 1px solid var(--border-color) !important;
      font-size: 0.9rem !important;
    }

    body:not(.dashboard) .results thead th a {
      color: var(--text-primary) !important;
      text-decoration: none !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.25rem !important;
    }

    body:not(.dashboard) .results thead th a:hover {
      color: var(--primary-color) !important;
    }

    body:not(.dashboard) .results tbody tr {
      transition: all 0.2s ease !important;
      border-bottom: 1px solid var(--border-color) !important;
      background: var(--bg-secondary) !important;
    }

    body:not(.dashboard) .results tbody tr:hover {
      background: var(--bg-primary) !important;
    }

    body:not(.dashboard) .results tbody tr:nth-child(even) {
      background: rgba(var(--bg-primary), 0.3) !important;
    }

    body:not(.dashboard) .results tbody tr:nth-child(even):hover {
      background: var(--bg-primary) !important;
    }

    body:not(.dashboard) .results tbody td {
      padding: 1rem !important;
      color: var(--text-primary) !important;
      font-size: 0.9rem !important;
      vertical-align: middle !important;
      border-bottom: 1px solid var(--border-color) !important;
    }

    body:not(.dashboard) .results tbody td a {
      color: var(--primary-color) !important;
      text-decoration: none !important;
      font-weight: 500 !important;
    }

    body:not(.dashboard) .results tbody td a:hover {
      color: var(--accent-color) !important;
      text-decoration: underline !important;
    }

    /* Checkbox styling */
    body:not(.dashboard) input[type="checkbox"] {
      width: 16px !important;
      height: 16px !important;
      accent-color: var(--primary-color) !important;
      border: 1px solid var(--border-color) !important;
      border-radius: 0.25rem !important;
    }

    /* Row action icons */
    body:not(.dashboard) .results tbody td .viewlink,
    body:not(.dashboard) .results tbody td .changelink,
    body:not(.dashboard) .results tbody td .deletelink {
      display: inline-block !important;
      width: 16px !important;
      height: 16px !important;
      margin: 0 0.25rem !important;
      opacity: 0.7 !important;
      transition: opacity 0.2s ease !important;
    }

    body:not(.dashboard) .results tbody td .viewlink:hover,
    body:not(.dashboard) .results tbody td .changelink:hover,
    body:not(.dashboard) .results tbody td .deletelink:hover {
      opacity: 1 !important;
    }

    /* Changelist styling */
    body:not(.dashboard) #changelist {
      background: transparent !important;
    }

    body:not(.dashboard) #changelist .results {
      overflow-x: auto !important;
    }

    body:not(.dashboard) #changelist-search {
      background: var(--bg-primary) !important;
      padding: 1rem 1.5rem !important;
      border-bottom: 1px solid var(--border-color) !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
      flex-direction: row !important;
    }

    body:not(.dashboard) #changelist-search * {
      margin: 0 !important;
    }

    body:not(.dashboard) #changelist-search label {
      color: var(--text-primary) !important;
      font-weight: 500 !important;
      margin: 0 !important;
      flex-shrink: 0 !important;
    }

    body:not(.dashboard) #changelist-search input[type="text"] {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-color) !important;
      color: var(--text-primary) !important;
      padding: 0.5rem 0.75rem !important;
      border-radius: 0.375rem !important;
      font-size: 0.9rem !important;
      min-width: 250px !important;
      flex: 1 !important;
      max-width: 400px !important;
      height: 38px !important;
      box-sizing: border-box !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
      margin: 0 !important;
    }

    body:not(.dashboard) #changelist-search input[type="submit"] {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      border: none !important;
      padding: 0.5rem 1rem !important;
      border-radius: 0.375rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      font-size: 0.9rem !important;
      transition: all 0.2s ease !important;
      height: 38px !important;
      box-sizing: border-box !important;
      flex-shrink: 0 !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
    }

    body:not(.dashboard) #changelist-search input[type="submit"]:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    body:not(.dashboard) #toolbar {
      background: var(--bg-primary) !important;
      padding: 1rem 1.5rem !important;
      border-bottom: 1px solid var(--border-color) !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: flex-start !important;
      flex-wrap: nowrap !important;
      gap: 1rem !important;
    }

    /* Form controls alignment */
    body:not(.dashboard) #toolbar form {
      display: flex !important;
      align-items: center !important;
      gap: 0.75rem !important;
      margin: 0 !important;
      width: 100% !important;
    }

    body:not(.dashboard) #toolbar * {
      margin: 0 !important;
    }

    body:not(.dashboard) #toolbar label {
      color: var(--text-primary) !important;
      font-weight: 500 !important;
      margin: 0 !important;
      font-size: 0.9rem !important;
      white-space: nowrap !important;
    }

    body:not(.dashboard) #toolbar select {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-color) !important;
      color: var(--text-primary) !important;
      padding: 0.5rem 0.75rem !important;
      border-radius: 0.375rem !important;
      font-size: 0.9rem !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
      height: 38px !important;
      box-sizing: border-box !important;
      margin: 0 !important;
    }

    body:not(.dashboard) #toolbar input[type="submit"],
    body:not(.dashboard) #toolbar button {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      border: none !important;
      padding: 0.5rem 1rem !important;
      border-radius: 0.375rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      font-size: 0.9rem !important;
      white-space: nowrap !important;
      transition: all 0.2s ease !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
      height: 38px !important;
      box-sizing: border-box !important;
      margin: 0 !important;
      flex-shrink: 0 !important;
      margin-left: 20px !important;
    }

    body:not(.dashboard) #toolbar input[type="submit"]:hover,
    body:not(.dashboard) #toolbar button:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    /* Style cho span k·∫øt qu·∫£ t√¨m ki·∫øm */
    body:not(.dashboard) #toolbar .small.quiet {
      color: var(--text-secondary) !important;
      font-size: 0.8rem !important;
      margin-left: 0.5rem !important;
      white-space: nowrap !important;
    }

    body:not(.dashboard) #toolbar .small.quiet a {
      color: var(--primary-color) !important;
      text-decoration: none !important;
    }

    body:not(.dashboard) #toolbar .small.quiet a:hover {
      text-decoration: underline !important;
    }

    /* Action buttons styling */
    body:not(.dashboard) .actions {
      background: var(--bg-primary) !important;
      padding: 1rem 0rem !important;
      border-bottom: 1px solid var(--border-color) !important;
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
      flex-wrap: nowrap !important;
      margin: 0 !important;
    }

    body:not(.dashboard) .actions * {
      margin: 0 !important;
    }

    body:not(.dashboard) .actions label {
      color: var(--text-primary) !important;
      font-weight: 500 !important;
      margin: 0 !important;
      font-size: 0.9rem !important;
      flex-shrink: 0 !important;
      margin-left: 90px !important;
    }

    body:not(.dashboard) .question {
      color: var(--text-secondary) !important;
      font-size: 0.85rem !important;
      font-style: italic !important;
      margin-left: 10px !important;
      margin-top: 15px !important;
    }

    /* Style cho text "X c·ªßa Y ƒë∆∞·ª£c ch·ªçn" */
    body:not(.dashboard) .actions .action-counter {
      color: var(--text-secondary) !important;
      font-size: 0.85rem !important;
      font-style: italic !important;
      margin-left: 10px !important;
      margin-top: 15px !important;
    }

    body:not(.dashboard) .actions select {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-color) !important;
      color: var(--text-primary) !important;
      padding: 0.5rem 0.75rem !important;
      border-radius: 0.375rem !important;
      min-width: 180px !important;
      font-size: 0.9rem !important;
      height: 38px !important;
      box-sizing: border-box !important;
      flex-shrink: 0 !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
      margin: 0 !important;
    }

    body:not(.dashboard) .actions button,
    body:not(.dashboard) .actions input[type="submit"] {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      border: none !important;
      padding: 0.375rem 0.875rem !important;
      border-radius: 0.375rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      font-size: 0.85rem !important;
      margin: 0 !important;
      transition: all 0.2s ease !important;
      height: 32px !important;
      box-sizing: border-box !important;
      flex-shrink: 0 !important;
      white-space: nowrap !important;
      vertical-align: middle !important;
      line-height: 1.2 !important;
      margin-top: 20px !important;
    }

    body:not(.dashboard) .actions button:hover,
    body:not(.dashboard) .actions input[type="submit"]:hover {
      transform: translateY(-1px) !important;
      box-shadow: var(--shadow-md) !important;
    }

    /* Pagination */
    body:not(.dashboard) .paginator {
      padding: 1rem 1.5rem !important;
      background: var(--bg-primary) !important;
      border-top: 1px solid var(--border-color) !important;
      text-align: center !important;
    }

    body:not(.dashboard) .paginator a,
    body:not(.dashboard) .paginator .this-page {
      display: inline-block !important;
      padding: 0.5rem 0.75rem !important;
      margin: 0 0.25rem !important;
      border-radius: 0.375rem !important;
      text-decoration: none !important;
      color: var(--text-primary) !important;
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-color) !important;
      transition: all 0.2s ease !important;
    }

    body:not(.dashboard) .paginator a:hover {
      background: var(--primary-color) !important;
      color: #ffffff !important;
    }

    body:not(.dashboard) .paginator .this-page {
      background: var(--primary-color) !important;
      color: #ffffff !important;
    }

    /* === RESPONSIVE DESIGN FOR FILTER === */
    @media (max-width: 1440px) {
      /* Tr√™n m√†n h√¨nh nh·ªè h∆°n, ƒë∆∞a filter v·ªÅ tr√™n c√πng ngay d∆∞·ªõi header */
      body:not(.dashboard) #changelist-filter {
        position: fixed !important;
        top: 60px !important; /* Ngay d∆∞·ªõi header */
        left: 0 !important;
        right: 0 !important;
        bottom: unset !important;
        width: 100% !important;
        max-width: none !important;
        height: auto !important;
        max-height: 50vh !important; /* TƒÉng chi·ªÅu cao l√™n 50% viewport height */
        min-height: 400px !important; /* ƒê·∫£m b·∫£o chi·ªÅu cao t·ªëi thi·ªÉu */
        z-index: 997 !important; /* Th·∫•p h∆°n header nh∆∞ng cao h∆°n content */
        border-radius: 0 !important;
        border-left: none !important;
        border-right: none !important;
        border-top: none !important;
        margin: 0 !important;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
      }

      body:not(.dashboard).filtered #content {
        padding-right: 1.5rem !important;
        padding-top: calc(1.5rem + 50vh) !important; /* ƒêi·ªÅu ch·ªânh theo chi·ªÅu cao filter */
      }

      body:not(.dashboard) #content-main {
        flex-direction: column !important;
      }

      body:not(.dashboard) .filter-toggle {
        display: none !important;
      }

      /* Adjust filter content for mobile */
      body:not(.dashboard) #changelist-filter h2 {
        padding: 0.75rem 1rem !important;
        font-size: 0.9rem !important;
        border-radius: 0 !important;
        flex-shrink: 0 !important; /* Kh√¥ng cho header co l·∫°i */
        margin-bottom: 0 !important; /* Lo·∫°i b·ªè margin bottom */
      }

      body:not(.dashboard) #changelist-filter > div {
        height: calc(100% - 60px) !important; /* Chi·ªÅu cao c√≤n l·∫°i sau khi tr·ª´ header */
        max-height: none !important; /* B·ªè gi·ªõi h·∫°n max-height */
        overflow-y: auto !important;
        flex: 1 !important;
        padding-top: 0 !important; /* Lo·∫°i b·ªè padding top */
      }

      /* ƒê·∫£m b·∫£o filter container s·ª≠ d·ª•ng flexbox */
      body:not(.dashboard) #changelist-filter {
        display: flex !important;
        flex-direction: column !important;
      }

      /* Lo·∫°i b·ªè kho·∫£ng tr·ªëng th·ª´a trong filter sections - MOBILE SPECIFIC */
      body:not(.dashboard) #changelist-filter > div > * {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
      }

      body:not(.dashboard) #changelist-filter > div > *:first-child {
        margin-top: 0 !important;
        padding-top: 0 !important;
      }

      /* MOBILE: T·ªëi ∆∞u spacing cho filter items */
      body:not(.dashboard) #changelist-filter .form-row {
        margin: 0 !important;
        padding: 0.75rem 1rem !important;
        border-bottom: 1px solid var(--border-color) !important;
      }

      body:not(.dashboard) #changelist-filter .form-row:first-child {
        margin-top: 0 !important;
        padding-top: 0.75rem !important;
      }

      body:not(.dashboard) #changelist-filter .form-row:last-child {
        border-bottom: none !important;
        margin-bottom: 0 !important;
        padding-bottom: 0.75rem !important;
      }

      /* MOBILE: Lo·∫°i b·ªè kho·∫£ng tr·ªëng cho checkbox v√† label */
      body:not(.dashboard) #changelist-filter .form-row label {
        margin: 0 !important;
        padding: 0 !important;
        margin-bottom: 0.5rem !important;
        display: block !important;
      }

      body:not(.dashboard) #changelist-filter .form-row input[type="checkbox"] {
        margin: 0 !important;
        margin-right: 0.5rem !important;
        vertical-align: middle !important;
      }

      /* MOBILE: Lo·∫°i b·ªè kho·∫£ng tr·ªëng kh√¥ng c·∫ßn thi·∫øt trong filter wrapper */
      body:not(.dashboard) #changelist-filter > div {
        height: calc(100% - 60px) !important;
        max-height: none !important;
        overflow-y: auto !important;
        flex: 1 !important;
        padding: 0 !important; /* Quan tr·ªçng: lo·∫°i b·ªè padding */
        margin: 0 !important; /* Quan tr·ªçng: lo·∫°i b·ªè margin */
      }

      /* MOBILE: ƒê·∫£m b·∫£o kh√¥ng c√≥ spacing th·ª´a ·ªü top */
      body:not(.dashboard) #changelist-filter > div > div:first-child,
      body:not(.dashboard) #changelist-filter > div > form:first-child {
        margin-top: 0 !important;
        padding-top: 0 !important;
      }

      /* MOBILE: CSS reset cho t·∫•t c·∫£ elements trong filter */
      body:not(.dashboard) #changelist-filter * {
        box-sizing: border-box !important;
      }

      body:not(.dashboard) #changelist-filter p {
        margin: 0 !important;
        padding: 0 !important;
      }

      body:not(.dashboard) #changelist-filter div {
        margin: 0 !important;
      }

      body:not(.dashboard) #changelist-filter div:not(.form-row) {
        padding: 0 !important;
      }

      /* T·ªëi ∆∞u cho c√°c dropdown v√† select */
      body:not(.dashboard) #changelist-filter select {
        max-width: 100% !important;
        width: 100% !important;
        padding: 0.75rem !important;
        font-size: 16px !important; /* Prevent zoom on iOS */
        border-radius: 0.5rem !important;
        margin-bottom: 0.5rem !important;
      }

      /* Responsive cho c√°c section trong filter */
      body:not(.dashboard) #changelist-filter h3 {
        padding: 0.75rem 1rem !important;
        font-size: 0.85rem !important;
        flex-shrink: 0 !important;
      }

      body:not(.dashboard) #changelist-filter ul {
        padding-bottom: 1rem !important; /* Th√™m padding bottom ƒë·ªÉ tr√°nh b·ªã c·∫Øt */
      }
    }

    /* === MOBILE OPTIMIZATIONS === */
    @media (max-width: 1024px) {
      /* Header mobile adjustments */
      #header {
        padding: 0.5rem 1rem !important;
        font-size: 0.9rem !important;
      }

      #header #site-name,
      #header #site-name a {
        font-size: 1rem !important;
      }

      #header #user-tools a {
        font-size: 0.75rem !important;
        padding: 0.25rem 0.5rem !important;
      }

      /* Sidebar mobile behavior */
      body:not(.dashboard) #nav-sidebar {
        width: 300px !important;
        transform: translateX(-100%) !important;
        transition: transform 0.3s ease !important;
      }

      body:not(.dashboard) #nav-sidebar.mobile-open {
        transform: translateX(0) !important;
      }

      body:not(.dashboard) #content {
        margin-left: 0 !important;
        padding: 1rem !important;
        padding-top: calc(1rem + 50vh) !important; /* ƒê·∫£m b·∫£o c√≥ space cho filter tr√™n mobile */
      }

      /* Mobile menu button */
      #mobile-menu-btn {
        display: block !important;
        position: fixed !important;
        top: 70px !important;
        left: 1rem !important;
        z-index: 1001 !important;
        background: var(--primary-color) !important;
        color: #ffffff !important;
        border: none !important;
        padding: 0.75rem !important;
        border-radius: 0.5rem !important;
        font-size: 1.25rem !important;
        cursor: pointer !important;
        box-shadow: var(--shadow-md) !important;
        transition: all 0.2s ease !important;
      }

      #mobile-menu-btn:hover {
        background: var(--primary-gradient) !important;
      }

      /* MOBILE FILTER - Lo·∫°i b·ªè ho√†n to√†n kho·∫£ng tr·ªëng */
      body:not(.dashboard) #changelist-filter {
        top: 60px !important;
        position: fixed !important;
        order: unset !important;
        margin: 0 !important; /* Reset margin */
        padding: 0 !important; /* Reset padding */
        border-radius: 0 !important;
        max-height: 50vh !important;
        min-height: 400px !important;
        z-index: 997 !important;
        display: flex !important;
        flex-direction: column !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
      }

      /* MOBILE FILTER HEADER - Kh√¥ng margin/padding th·ª´a */
      body:not(.dashboard) #changelist-filter h2 {
        padding: 0.75rem 1rem !important;
        font-size: 0.9rem !important;
        border-radius: 0 !important;
        flex-shrink: 0 !important;
        margin: 0 !important; /* Reset margin */
      }

      /* MOBILE FILTER CONTENT - Reset ho√†n to√†n */
      body:not(.dashboard) #changelist-filter > div {
        height: calc(100% - 60px) !important;
        max-height: none !important;
        overflow-y: auto !important;
        flex: 1 !important;
        padding: 0 !important; /* Reset padding */
        margin: 0 !important; /* Reset margin */
      }

      /* MOBILE: Force reset t·∫•t c·∫£ spacing trong filter */
      body:not(.dashboard) #changelist-filter > div > * {
        margin: 0 !important;
      }

      body:not(.dashboard) #changelist-filter > div > *:first-child {
        margin-top: 0 !important;
        padding-top: 0 !important;
      }

      body:not(.dashboard) #changelist-filter .form-row {
        margin: 0 !important;
        padding: 0.75rem 1rem !important;
        border-bottom: 1px solid var(--border-color) !important;
      }

      body:not(.dashboard) #changelist-filter .form-row:first-child {
        margin-top: 0 !important;
        padding-top: 0.75rem !important;
      }

      body:not(.dashboard) #changelist-filter .form-row:last-child {
        border-bottom: none !important;
        margin-bottom: 0 !important;
        padding-bottom: 0.75rem !important;
      }

      /* MOBILE: Reset cho labels v√† inputs */
      body:not(.dashboard) #changelist-filter .form-row label {
        margin: 0 !important;
        padding: 0 !important;
        margin-bottom: 0.5rem !important;
        display: block !important;
      }

      /* MOBILE: Reset cho divs v√† paragraphs */
      body:not(.dashboard) #changelist-filter p,
      body:not(.dashboard) #changelist-filter div:not(.form-row) {
        margin: 0 !important;
        padding: 0 !important;
      }

      /* MOBILE SEARCH AND TOOLBAR OPTIMIZATIONS */
      body:not(.dashboard) #changelist-search {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
        padding: 1rem !important;
      }

      body:not(.dashboard) #changelist-search label {
        font-size: 0.85rem !important;
        margin-bottom: 0.25rem !important;
      }

      body:not(.dashboard) #changelist-search input[type="text"] {
        min-width: auto !important;
        max-width: none !important;
        width: 100% !important;
        font-size: 16px !important; /* Prevent zoom on iOS */
        padding: 0.75rem !important;
        height: 44px !important; /* Touch-friendly height */
      }

      body:not(.dashboard) #changelist-search input[type="submit"] {
        width: 100% !important;
        padding: 0.75rem 1rem !important;
        font-size: 1rem !important;
        height: 44px !important;
        border-radius: 0.5rem !important;
      }

      /* MOBILE TOOLBAR OPTIMIZATIONS */
      body:not(.dashboard) #toolbar {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
        padding: 1rem !important;
      }

      body:not(.dashboard) #toolbar form {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
      }

      body:not(.dashboard) #toolbar label {
        font-size: 0.85rem !important;
        margin-bottom: 0.25rem !important;
      }

      body:not(.dashboard) #toolbar select {
        width: 100% !important;
        font-size: 16px !important; /* Prevent zoom on iOS */
        padding: 0.75rem !important;
        height: 44px !important;
      }

      body:not(.dashboard) #toolbar input[type="submit"],
      body:not(.dashboard) #toolbar button {
        width: 100% !important;
        padding: 0.75rem 1rem !important;
        font-size: 1rem !important;
        height: 44px !important;
        margin-left: 0 !important;
        border-radius: 0.5rem !important;
      }

      /* MOBILE ACTIONS OPTIMIZATIONS */
      body:not(.dashboard) .actions {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
        padding: 1rem !important;
      }

      body:not(.dashboard) .actions label {
        margin-left: 0 !important;
        font-size: 0.85rem !important;
        margin-bottom: 0.25rem !important;
      }

      body:not(.dashboard) .actions select {
        min-width: auto !important;
        width: 100% !important;
        font-size: 16px !important; /* Prevent zoom on iOS */
        padding: 0.75rem !important;
        height: 44px !important;
      }

      body:not(.dashboard) .actions button,
      body:not(.dashboard) .actions input[type="submit"] {
        width: 100% !important;
        padding: 0.75rem 1rem !important;
        font-size: 1rem !important;
        height: 44px !important;
        margin-top: 0 !important;
        border-radius: 0.5rem !important;
      }

      body:not(.dashboard) .question,
      body:not(.dashboard) .actions .action-counter {
        margin-left: 0 !important;
        margin-top: 0.5rem !important;
        text-align: center !important;
      }

      /* Form responsive optimizations */
      body:not(.dashboard) .form-row.field-first_name,
      body:not(.dashboard) .form-row.field-last_name {
        display: block !important;
        width: 100% !important;
        margin-right: 0 !important;
      }

      /* Input optimizations for mobile */
      body:not(.dashboard) input[type="text"],
      body:not(.dashboard) input[type="email"],
      body:not(.dashboard) input[type="password"],
      body:not(.dashboard) input[type="number"],
      body:not(.dashboard) input[type="date"],
      body:not(.dashboard) input[type="datetime-local"],
      body:not(.dashboard) select,
      body:not(.dashboard) textarea {
        font-size: 16px !important; /* Prevent zoom on iOS */
        padding: 0.75rem !important;
        min-height: 44px !important; /* Touch-friendly */
      }

      /* Filter mobile adjustments - ƒë·∫£m b·∫£o filter lu√¥n ·ªü tr√™n c√πng */
      body:not(.dashboard) #changelist-filter {
        top: 60px !important; /* C·ªë ƒë·ªãnh ngay d∆∞·ªõi header */
        position: fixed !important;
        order: unset !important;
        margin-top: 0 !important;
        border-radius: 0 !important;
        max-height: 50vh !important; /* TƒÉng chi·ªÅu cao cho mobile */
        min-height: 400px !important; /* ƒê·∫£m b·∫£o chi·ªÅu cao t·ªëi thi·ªÉu */
        z-index: 997 !important;
        display: flex !important;
        flex-direction: column !important;
      }
      
      body:not(.dashboard) #changelist {
        order: unset !important;
      }

      /* Mobile table responsiveness */
      body:not(.dashboard) .results {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
      }

      body:not(.dashboard) .results table {
        min-width: 600px !important;
        font-size: 0.85rem !important;
      }

      body:not(.dashboard) .results thead th,
      body:not(.dashboard) .results tbody td {
        padding: 0.5rem !important;
        white-space: nowrap !important;
      }

      /* Object tools mobile */
      body:not(.dashboard) #content .object-tools {
        padding: 1rem !important;
        flex-direction: column !important;
        gap: 0.75rem !important;
      }

      body:not(.dashboard) #content .object-tools ul {
        flex-direction: column !important;
        gap: 0.5rem !important;
      }

      /* Pagination mobile */
      body:not(.dashboard) .paginator {
        padding: 1rem !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        gap: 0.5rem !important;
        flex-wrap: wrap !important;
      }

      body:not(.dashboard) .paginator a,
      body:not(.dashboard) .paginator .this-page {
        min-width: 44px !important;
        min-height: 44px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 0.9rem !important;
      }
    }

    /* Hide mobile menu button on desktop */
    @media (min-width: 1025px) {
      #mobile-menu-btn {
        display: none !important;
      }
    }

    /* === Error and Success Messages === */
    body:not(.dashboard) .messagelist {
      margin: 0 1.5rem 1rem 1.5rem !important;
      padding: 0 !important;
      list-style: none !important;
    }

    body:not(.dashboard) .messagelist li {
      padding: 0.75rem 1rem !important;
      margin-bottom: 0.5rem !important;
      border-radius: 0.5rem !important;
      font-size: 0.9rem !important;
    }

    body:not(.dashboard) .messagelist .success {
      background: rgba(16, 185, 129, 0.1) !important;
      color: var(--success-color) !important;
      border: 1px solid var(--success-color) !important;
    }

    body:not(.dashboard) .messagelist .error {
      background: rgba(239, 68, 68, 0.1) !important;
      color: var(--danger-color) !important;
      border: 1px solid var(--danger-color) !important;
    }

    body:not(.dashboard) .messagelist .warning {
      background: rgba(245, 158, 11, 0.1) !important;
      color: var(--warning-color) !important;
      border: 1px solid var(--warning-color) !important;
    }

    body:not(.dashboard) .messagelist .info {
      background: rgba(59, 130, 246, 0.1) !important;
      color: var(--primary-color) !important;
      border: 1px solid var(--primary-color) !important;
    }

    /* === Breadcrumbs === */
    body:not(.dashboard) .breadcrumbs {
      background: var(--bg-primary) !important;
      color: var(--text-secondary) !important;
      padding: 0.75rem 1.5rem !important;
      border-bottom: 1px solid var(--border-color) !important;
      margin: 0 !important;
      font-size: 0.85rem !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
    }

    body:not(.dashboard) .breadcrumbs a {
      color: var(--primary-color) !important;
      text-decoration: none !important;
    }

    body:not(.dashboard) .breadcrumbs a:hover {
      color: var(--accent-color) !important;
      text-decoration: underline !important;
    }

    /* === Date/Time Field Fixes === */
    body:not(.dashboard) .datetime {
      display: flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
    }

    body:not(.dashboard) .datetime input {
      max-width: 150px !important;
    }

    body:not(.dashboard) .vDateField,
    body:not(.dashboard) .vTimeField {
      max-width: 120px !important;
    }

    /* === Inline Form Fixes === */
    body:not(.dashboard) .inline-group {
      margin-bottom: 1.5rem !important;
    }

    body:not(.dashboard) .inline-related {
      background: var(--bg-primary) !important;
      border: 1px solid var(--border-color) !important;
      border-radius: 0.5rem !important;
      padding: 1rem !important;
      margin-bottom: 1rem !important;
    }

    body:not(.dashboard) .inline-related h3 {
      background: var(--primary-gradient) !important;
      color: #ffffff !important;
      margin: -1rem -1rem 1rem -1rem !important;
      padding: 0.75rem 1rem !important;
      border-radius: 0.5rem 0.5rem 0 0 !important;
    }

    /* === Help Text === */
    body:not(.dashboard) .help {
      color: var(--text-secondary) !important;
      font-size: 0.8rem !important;
      margin-top: 0.25rem !important;
      font-style: italic !important;
    }

    /* === Field Errors === */
    body:not(.dashboard) .errorlist {
      color: var(--danger-color) !important;
      background: rgba(239, 68, 68, 0.1) !important;
      border: 1px solid var(--danger-color) !important;
      border-radius: 0.375rem !important;
      padding: 0.5rem !important;
      margin: 0.5rem 0 !important;
      font-size: 0.85rem !important;
      list-style: none !important;
    }

    body:not(.dashboard) .errorlist li {
      margin: 0 !important;
      padding: 0 !important;
    }

    /* === Empty State === */
    body:not(.dashboard) .results p {
      color: var(--text-secondary) !important;
      text-align: center !important;
      padding: 2rem !important;
      font-style: italic !important;
    }

    /* === Loading States === */
    body:not(.dashboard) .loading {
      color: var(--text-secondary) !important;
      text-align: center !important;
      padding: 1rem !important;
    }

    /* === Dark Mode Text Contrast Fix === */
    html[data-theme="dark"] body:not(.dashboard) {
      color: var(--text-primary) !important;
    }

    html[data-theme="dark"] body:not(.dashboard) * {
      border-color: var(--border-color) !important;
    }

    html[data-theme="dark"] body:not(.dashboard) .results tbody td {
      color: var(--text-primary) !important;
    }

    html[data-theme="dark"] body:not(.dashboard) input,
    html[data-theme="dark"] body:not(.dashboard) select,
    html[data-theme="dark"] body:not(.dashboard) textarea {
      background: var(--bg-secondary) !important;
      color: var(--text-primary) !important;
      border-color: var(--border-color) !important;
    }

    html[data-theme="dark"] body:not(.dashboard) input::placeholder,
    html[data-theme="dark"] body:not(.dashboard) textarea::placeholder {
      color: var(--text-secondary) !important;
    }

    /* === FILTER ANIMATIONS === */
    @keyframes filterRefresh {
      0% { transform: translateX(10px); opacity: 0.8; }
      100% { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes filterSlideIn {
      from { 
        transform: translateX(100%) scale(0.95); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0) scale(1); 
        opacity: 1; 
      }
    }

    /* === FORCE BUTTON MARGIN FIX === */
    #toolbar form,
    div#toolbar form,
    body:not(.dashboard) #toolbar form {
      display: flex !important;
      flex-direction: row !important;
      align-items: center !important;
      gap: 0.75rem !important;
      width: 100% !important;
      margin: 0 !important;
      flex-wrap: nowrap !important;
    }

    /* Force t·∫•t c·∫£ children th√†nh flex items */
    #toolbar form > *,
    div#toolbar form > *,
    body:not(.dashboard) #toolbar form > * {
      display: inline-flex !important;
      align-items: center !important;
      margin: 0 !important;
    }

    /* Specific elements */
    #toolbar form label,
    #toolbar form img {
      flex-shrink: 0 !important;
      display: inline-flex !important;
    }

    #toolbar form input[type="text"] {
      flex: 1 !important;
      max-width: 400px !important;
      display: inline-flex !important;
    }

    #toolbar form input[type="submit"] {
      flex-shrink: 0 !important;
      display: inline-flex !important;
      margin: 0 !important;
      margin-left: 0 !important;
    }

    #toolbar form .small.quiet {
      flex-shrink: 0 !important;
      display: inline-flex !important;
      margin-left: 0.5rem !important;
    }

    /* Force container div */
    #toolbar form > div {
      display: flex !important;
      flex-direction: row !important;
      align-items: center !important;
      gap: 0.75rem !important;
      width: 100% !important;
      flex-wrap: nowrap !important;
    }

    /* Mobile responsive adjustments override desktop */
    @media (max-width: 1024px) {
      #toolbar form,
      div#toolbar form,
      body:not(.dashboard) #toolbar form {
        flex-direction: column !important;
      }

      #toolbar form > div {
        flex-direction: column !important;
        width: 100% !important;
      }

      #toolbar form input[type="text"] {
        max-width: none !important;
        width: 100% !important;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // === FILTER POSITIONING & TOGGLE ===
      function initFilterLayout() {
        const filter = document.getElementById('changelist-filter');
        const body = document.body;
        
        if (filter && !body.classList.contains('dashboard')) {
          // Th√™m class 'filtered' v√†o body khi c√≥ filter
          body.classList.add('filtered');
          
          // T·∫°o toggle button cho filter (ch·ªâ tr√™n desktop)
          if (window.innerWidth > 1440) {
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'filter-toggle';
            toggleBtn.title = '·∫®n/Hi·ªán b·ªô l·ªçc';
            toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
            document.body.appendChild(toggleBtn);
            
            // X·ª≠ l√Ω toggle filter
            toggleBtn.addEventListener('click', function() {
              const isHidden = filter.classList.contains('hidden');
              
              if (isHidden) {
                filter.classList.remove('hidden');
                body.classList.add('filtered');
                toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                toggleBtn.title = '·∫®n b·ªô l·ªçc';
              } else {
                filter.classList.add('hidden');
                body.classList.remove('filtered');
                toggleBtn.innerHTML = '<i class="fas fa-filter"></i>';
                toggleBtn.title = 'Hi·ªán b·ªô l·ªçc';
              }
            });
          }
          
          // Auto-hide filter on mobile
          function checkMobileFilter() {
            const toggleBtn = document.querySelector('.filter-toggle');
            if (window.innerWidth <= 1440) {
              filter.classList.remove('hidden');
              body.classList.remove('filtered');
              if (toggleBtn) toggleBtn.style.display = 'none';
            } else {
              if (toggleBtn) toggleBtn.style.display = 'flex';
            }
          }
          
          // Check on load and resize
          checkMobileFilter();
          window.addEventListener('resize', checkMobileFilter);
          
          // Smooth scroll cho filter links
          const filterLinks = filter.querySelectorAll('a');
          filterLinks.forEach(link => {
            link.addEventListener('click', function(e) {
              // Add loading state
              const originalText = this.textContent;
              this.style.opacity = '0.6';
              this.textContent = originalText + ' ‚è≥';
              
              // Reset after navigation (will be interrupted by page load)
              setTimeout(() => {
                this.style.opacity = '1';
                this.textContent = originalText;
              }, 100);
            });
          });
          
          // Enhanced filter styling
          const filterTitle = filter.querySelector('h2');
          if (filterTitle) {
            filterTitle.innerHTML = '<i class="fas fa-magic"></i> B·ªò L·ªåC TH√îNG MINH';
          }
          
          // Add search functionality to filter
          addFilterSearch(filter);
        } else if (!filter && body.classList.contains('filtered')) {
          // Remove filtered class if no filter exists
          body.classList.remove('filtered');
        }
      }
      
      // === FILTER SEARCH FUNCTIONALITY ===
      function addFilterSearch(filter) {
        const filterSections = filter.querySelectorAll('ul');
        
        filterSections.forEach((ul, index) => {
          const section = ul.closest('div, li') || ul.parentElement;
          const header = section.querySelector('h3');
          
          if (header && ul.children.length > 5) { // Only add search if many options
            const searchContainer = document.createElement('div');
            searchContainer.style.cssText = `
              padding: 0.75rem 1.25rem;
              background: rgba(79, 70, 229, 0.05);
              border-bottom: 1px solid rgba(79, 70, 229, 0.1);
            `;
            
            const searchInput = document.createElement('input');
            searchInput.type = 'text';
            searchInput.placeholder = 'üîç T√¨m ki·∫øm nhanh...';
            searchInput.style.cssText = `
              width: 100%;
              padding: 0.75rem;
              border: 2px solid var(--filter-accent);
              border-radius: 0.5rem;
              background: var(--bg-secondary);
              color: var(--text-primary);
              font-size: 0.85rem;
              box-sizing: border-box;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
            `;
            
            searchInput.addEventListener('focus', function() {
              this.style.boxShadow = '0 4px 16px rgba(79, 70, 229, 0.2)';
              this.style.borderColor = '#7c3aed';
            });
            
            searchInput.addEventListener('blur', function() {
              this.style.boxShadow = '0 2px 8px rgba(79, 70, 229, 0.1)';
              this.style.borderColor = 'var(--filter-accent)';
            });
            
            searchContainer.appendChild(searchInput);
            ul.parentNode.insertBefore(searchContainer, ul);
            
            // Search functionality
            searchInput.addEventListener('input', function() {
              const searchTerm = this.value.toLowerCase();
              const items = ul.querySelectorAll('li');
              let visibleCount = 0;
              
              items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                  item.style.display = '';
                  item.style.animation = 'fadeInUp 0.3s ease';
                  visibleCount++;
                } else {
                  item.style.display = 'none';
                }
              });
              
              // Show/hide no results message
              let noResultsMsg = ul.querySelector('.no-results');
              
              if (visibleCount === 0 && searchTerm) {
                if (!noResultsMsg) {
                  noResultsMsg = document.createElement('li');
                  noResultsMsg.className = 'no-results';
                  noResultsMsg.style.cssText = `
                    padding: 1.5rem;
                    text-align: center;
                    color: var(--text-secondary);
                    font-style: italic;
                    font-size: 0.9rem;
                    background: rgba(79, 70, 229, 0.05);
                  `;
                  noResultsMsg.innerHTML = 'üîç Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p';
                  ul.appendChild(noResultsMsg);
                }
                noResultsMsg.style.display = '';
              } else if (noResultsMsg) {
                noResultsMsg.style.display = 'none';
              }
            });
          }
        });
      }
      
      // === FILTER KEYBOARD SHORTCUTS ===
      function initFilterKeyboardShortcuts() {
        document.addEventListener('keydown', function(e) {
          // Alt + F to toggle filter
          if (e.altKey && e.key.toLowerCase() === 'f') {
            e.preventDefault();
            const toggleBtn = document.querySelector('.filter-toggle');
            if (toggleBtn) {
              toggleBtn.click();
            }
          }
          
          // Escape to close filter (when focused inside filter)
          if (e.key === 'Escape') {
            const filter = document.getElementById('changelist-filter');
            if (filter && filter.contains(document.activeElement)) {
              filter.classList.add('hidden');
              document.body.classList.remove('filtered');
              const toggleBtn = document.querySelector('.filter-toggle');
              if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-filter"></i>';
                toggleBtn.title = 'Hi·ªán b·ªô l·ªçc';
              }
            }
          }
        });
      }
      
      // === ENHANCED FILTER ANIMATIONS ===
      function addFilterAnimations() {
        const filter = document.getElementById('changelist-filter');
        if (!filter) return;
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
          @keyframes fadeInUp {
            from {
              opacity: 0;
              transform: translateY(10px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          
          @keyframes filterGlow {
            0%, 100% {
              box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            }
            50% {
              box-shadow: 0 12px 35px rgba(124, 58, 237, 0.6);
            }
          }
          
          body:not(.dashboard) #changelist-filter:hover {
            animation: filterGlow 2s ease-in-out infinite;
          }
        `;
        document.head.appendChild(style);
        
        // Add loading animation for filter changes
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' || mutation.type === 'subtree') {
              // Filter content changed, add refresh animation
              filter.style.animation = 'filterRefresh 0.3s ease';
              setTimeout(() => {
                filter.style.animation = '';
              }, 300);
            }
          });
        });
        
        observer.observe(filter, {
          childList: true,
          subtree: true
        });
      }

      // Mobile menu functionality
      if (window.innerWidth <= 1024 && !document.body.classList.contains('dashboard')) {
        const mobileBtn = document.createElement('button');
        mobileBtn.id = 'mobile-menu-btn';
        mobileBtn.innerHTML = '<i class="fas fa-bars"></i>';
        document.body.appendChild(mobileBtn);

        mobileBtn.addEventListener('click', function() {
          const sidebar = document.getElementById('nav-sidebar');
          if (sidebar) {
            sidebar.classList.toggle('mobile-open');
          }
        });

        // Close sidebar when clicking outside
        document.addEventListener('click', function(e) {
          const sidebar = document.getElementById('nav-sidebar');
          const btn = document.getElementById('mobile-menu-btn');
          if (sidebar && !sidebar.contains(e.target) && !btn.contains(e.target)) {
            sidebar.classList.remove('mobile-open');
          }
        });
      }

      // Thay text "Meals" ‚Üí "CH·ª®C NƒÇNG"
      const mealsCap = document.querySelector(
        'nav#nav-sidebar .app-meals.module table caption a.section'
      );
      if (mealsCap) {
        mealsCap.textContent = 'CH·ª®C NƒÇNG';
        mealsCap.setAttribute('title', 'C√°c ch·ª©c nƒÉng');
      }
      
      // Thay text "Authentication and Authorization" ‚Üí "X√ÅC TH·ª∞C V√Ä ·ª¶Y QUY·ªÄN"
      const authCap = document.querySelector(
        'nav#nav-sidebar .app-auth.module table caption a.section'
      );
      if (authCap) {
        authCap.textContent = 'X√ÅC TH·ª∞C V√Ä ·ª¶Y QUY·ªÄN';
        authCap.setAttribute('title', 'X√°c th·ª±c v√† ·ªßy quy·ªÅn');
      }

      // T√¨m <tbody> c·ªßa module Meals
      const tbody = document.querySelector(
        'nav#nav-sidebar .app-meals.module table tbody'
      );
      if (tbody) {
        // H√†m t·∫°o <tr> m·ªõi
        function makeRow(url, text, iconClass, cssClass) {
          const tr = document.createElement('tr');
          tr.className = cssClass;
          tr.innerHTML = `
            <th scope="row">
              <a href="${url}">
                <i class="${iconClass}"></i>
                ${text}
              </a>
            </th>
            <td>
              <a href="${url}" class="changelink">{% trans "ƒêi ƒë·∫øn" %}</a>
            </td>
          `;
          return tr;
        }

        const statsURL = "{% url 'meals:statistics' %}";
        const debtURL  = "{% url 'meals:student_payment_edit' %}";
        const statsText= "{% trans 'Th·ªëng k√™' %}";
        const debtText = "{% trans 'Ch·ªânh s·ª≠a c√¥ng n·ª£' %}";

        // Ch√®n "Ch·ªânh s·ª≠a c√¥ng n·ª£" (row2) v√† "Th·ªëng k√™" (row1) l√™n ƒë·∫ßu danh s√°ch
        tbody.insertBefore(makeRow(debtURL, debtText, 'fas fa-edit', 'row2'), tbody.firstChild);
        tbody.insertBefore(makeRow(statsURL, statsText, 'fas fa-chart-pie', 'row1'), tbody.firstChild);

        // ·∫®N HO√ÄN TO√ÄN C√îNG N·ª¢ H·ªåC SINH - nhi·ªÅu c√°ch ƒë·ªÉ ƒë·∫£m b·∫£o
        const allRows = tbody.querySelectorAll('tr');
        allRows.forEach(row => {
          const linkText = row.querySelector('th a');
          if (linkText && (
            linkText.textContent.includes('C√¥ng n·ª£ h·ªçc sinh') ||
            linkText.textContent.includes('Student debt') ||
            linkText.textContent.includes('studentpayment') ||
            linkText.href.includes('student_debt') ||
            linkText.href.includes('studentpayment') ||
            row.classList.contains('model-studentpayment')
          )) {
            row.style.display = 'none !important';
            row.style.visibility = 'hidden !important';
            row.remove(); // X√≥a lu√¥n kh·ªèi DOM
          }
        });

        // Th√™m CSS rule ƒë·ªÉ ƒë·∫£m b·∫£o ·∫©n ho√†n to√†n
        const hideStyle = document.createElement('style');
        hideStyle.textContent = `
          .model-studentpayment,
          tr.model-studentpayment,
          [href*="studentpayment"],
          a[href*="studentpayment"],
          tr:has(a[href*="studentpayment"]) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            overflow: hidden !important;
          }
        `;
        document.head.appendChild(hideStyle);

        // Th√™m icons v√†o c√°c menu items c√≥ s·∫µn
        const links = tbody.querySelectorAll('th a');
        links.forEach(link => {
          const text = link.textContent.trim();
          const iconSpan = link.querySelector('i');
          
          if (!iconSpan) { // Ch·ªâ th√™m icon n·∫øu ch∆∞a c√≥
            let iconClass = '';
            if (text.includes('Students') || text.includes('H·ªçc sinh')) {
              iconClass = 'fas fa-users';
            } else if (text.includes('Meal records') || text.includes('B·ªØa ƒÉn') || text.includes('meal')) {
              iconClass = 'fas fa-utensils';
            } else if (text.includes('Meal balance audits') || text.includes('audit')) {
              iconClass = 'fas fa-file-alt';
            } else if (text.includes('Student health infos') || text.includes('health')) {
              iconClass = 'fas fa-heart';
            } else if (text.includes('Study groups')) {
              iconClass = 'fas fa-users-cog';
            } else if (text.includes('Study classes')) {
              iconClass = 'fas fa-chalkboard';
            }
            
            if (iconClass) {
              const icon = document.createElement('i');
              icon.className = iconClass;
              link.insertBefore(icon, link.firstChild);
            }
          }
        });
      }

      // Th√™m icons v√†o auth module
      const authTbody = document.querySelector(
        'nav#nav-sidebar .app-auth.module table tbody'
      );
      if (authTbody) {
        const authLinks = authTbody.querySelectorAll('th a');
        authLinks.forEach(link => {
          const text = link.textContent.trim();
          const iconSpan = link.querySelector('i');
          
          if (!iconSpan) {
            let iconClass = '';
            if (text.includes('Groups') || text.includes('Nh√≥m')) {
              iconClass = 'fas fa-users-cog';
            } else if (text.includes('Users') || text.includes('Ng∆∞·ªùi d√πng')) {
              iconClass = 'fas fa-user';
            }
            
            if (iconClass) {
              const icon = document.createElement('i');
              icon.className = iconClass;
              link.insertBefore(icon, link.firstChild);
            }
          }
        });
      }

      // === INITIALIZE ALL FILTER FEATURES ===
      initFilterLayout();
      initFilterKeyboardShortcuts();
      addFilterAnimations();
      
      // === REORGANIZE ACTION BUTTONS ===
      function reorganizeActionButtons() {
        const objectTools = document.querySelector('#content .object-tools');
        const moduleAligned = document.querySelector('#content .module.aligned');
        
        if (!objectTools || !moduleAligned) return;
        
        // Find all custom action buttons that are outside object-tools
        const customButtons = document.querySelectorAll(`
          #content a[href*="/delete_students/"]:not(.object-tools a),
          #content a[href*="/export_students/"]:not(.object-tools a),
          #content a[href*="/import_students/"]:not(.object-tools a),
          #content a[href*="/promote_students/"]:not(.object-tools a)
        `);
        
        if (customButtons.length > 0) {
          // Create a container for custom buttons
          const customButtonsContainer = document.createElement('div');
          customButtonsContainer.className = 'custom-action-buttons';
          customButtonsContainer.style.cssText = `
            display: flex !important;
            gap: 0.75rem !important;
            flex-wrap: wrap !important;
            margin-bottom: 1.5rem !important;
            padding: 1rem 1.5rem !important;
            background: var(--bg-primary) !important;
            border-bottom: 1px solid var(--border-color) !important;
            border-radius: 0.75rem 0.75rem 0 0 !important;
          `;
          
          // Create proper styled buttons from the links
          customButtons.forEach(originalLink => {
            // Create new button element
            const button = document.createElement('a');
            button.href = originalLink.href;
            button.style.cssText = `
              display: inline-flex !important;
              align-items: center !important;
              gap: 0.5rem !important;
              padding: 0.75rem 1.25rem !important;
              border-radius: 0.5rem !important;
              text-decoration: none !important;
              font-weight: 600 !important;
              font-size: 0.9rem !important;
              transition: all 0.3s ease !important;
              cursor: pointer !important;
              border: none !important;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
              text-transform: none !important;
              letter-spacing: normal !important;
              color: #ffffff !important;
            `;
            
            // Add specific styling and content based on button type
            if (originalLink.href.includes('/delete_students/')) {
              button.innerHTML = '<i class="fas fa-trash-alt"></i> X√≥a to√†n b·ªô h·ªçc sinh';
              button.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
              button.addEventListener('mouseenter', () => {
                button.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 4px 12px rgba(239, 68, 68, 0.3)';
              });
              button.addEventListener('mouseleave', () => {
                button.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
              });
            } else if (originalLink.href.includes('/export_students/')) {
              button.innerHTML = '<i class="fas fa-download"></i> Export H·ªçc sinh';
              button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
              button.addEventListener('mouseenter', () => {
                button.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 4px 12px rgba(16, 185, 129, 0.3)';
              });
              button.addEventListener('mouseleave', () => {
                button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
              });
            } else if (originalLink.href.includes('/import_students/')) {
              button.innerHTML = '<i class="fas fa-upload"></i> Import H·ªçc sinh';
              button.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
              button.addEventListener('mouseenter', () => {
                button.style.background = 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)';
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
              });
              button.addEventListener('mouseleave', () => {
                button.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
              });
            } else if (originalLink.href.includes('/promote_students/')) {
              button.innerHTML = '<i class="fas fa-level-up-alt"></i> L√™n L·ªõp';
              button.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
              button.addEventListener('mouseenter', () => {
                button.style.background = 'linear-gradient(135deg, #d97706 0%, #b45309 100%)';
                button.style.transform = 'translateY(-2px)';
                button.style.boxShadow = '0 4px 12px rgba(245, 158, 11, 0.3)';
              });
              button.addEventListener('mouseleave', () => {
                button.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
              });
            }
            
            // Add button to container
            customButtonsContainer.appendChild(button);
            
            // Hide the original link
            originalLink.style.display = 'none';
          });
          
          // Insert container BEFORE the module.aligned
          moduleAligned.parentNode.insertBefore(customButtonsContainer, moduleAligned);
        }
        
        // Add icon to history button if it exists
        const historyButton = objectTools.querySelector('.historylink');
        if (historyButton && !historyButton.querySelector('i')) {
          historyButton.innerHTML = '<i class="fas fa-history"></i> ' + historyButton.textContent.trim();
        }
        
        // Also ensure object-tools styling is clean - NO BORDER
        objectTools.style.cssText = `
          background: transparent !important;
          padding: 0 !important;
          border: none !important;
          margin: 0 !important;
          margin-bottom: 1.5rem !important;
          border-radius: 0 !important;
          box-shadow: none !important;
          position: relative !important;
          z-index: 1 !important;
          display: flex !important;
          flex-direction: column !important;
          gap: 1rem !important;
          clear: both !important;
        `;

        // Style the history button container specifically
        const historyButtonContainer = objectTools.querySelector('ul');
        if (historyButtonContainer) {
          historyButtonContainer.style.cssText = `
            list-style: none !important;
            padding: 0 !important;
            margin: 0 !important;
            display: flex !important;
            gap: 0.75rem !important;
            flex-wrap: wrap !important;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            position: static !important;
            float: none !important;
            clear: both !important;
          `;
        }

        // Ensure any li elements are also clean
        const allLis = objectTools.querySelectorAll('li');
        allLis.forEach(li => {
          li.style.cssText = `
            margin: 0 !important;
            padding: 0 !important;
            background: transparent !important;
            border: none !important;
            list-style: none !important;
            float: none !important;
            position: static !important;
          `;
        });
      }
      
      // Run after DOM is ready
      setTimeout(reorganizeActionButtons, 100);
      
      // Reinitialize on AJAX content changes (Django admin sometimes uses AJAX)
      if (window.MutationObserver) {
        const observer = new MutationObserver(function(mutations) {
          let shouldReinit = false;
          mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length > 0) {
              mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1 && (
                    node.id === 'changelist-filter' || 
                    node.querySelector && node.querySelector('#changelist-filter')
                  )) {
                  shouldReinit = true;
                }
              });
            }
          });
          
          if (shouldReinit) {
            setTimeout(initFilterLayout, 100);
          }
        });
        
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      }
    });

    // Handle window resize
    window.addEventListener('resize', function() {
      if (!document.body.classList.contains('dashboard')) {
        const sidebar = document.getElementById('nav-sidebar');
        const btn = document.getElementById('mobile-menu-btn');
        
        if (window.innerWidth > 1024) {
          if (sidebar) sidebar.classList.remove('mobile-open');
          if (btn) btn.style.display = 'none';
        } else {
          if (btn) btn.style.display = 'block';
        }
      }
    });
  </script>
{% endblock %}